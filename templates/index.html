<!--
Citations:
The ul menubars are based on the following w3 code: https://www.w3.org/TR/wai-aria-practices/examples/menubar/menubar-2/menubar-2.html
-->
{% extends "layout.html" %}
{% block title %}Homepage{% endblock %}
{% block h1 %}Accessible Video Editor{% if uploaded_video %}: {{uploaded_video}} {% endif %}{% endblock %}
{% block link1href %}/about{% endblock %}
{% block link1text %}About{% endblock %}

{% block box2editorattributes %}
{% if not uploaded_video %}
style="display:none;"
{% endif %}
{% endblock %}
<!-- TODO: Figure out how to make these considered alerts to screen reader users.
Setting an alert role didn't seem to help; should the alerts go at the top of the page? Decide later. -->
{% block box1role %}alert{% endblock %}
{% block box1h2attributes %}class="screen-reader-text"{% endblock %}
{% block box1h2 %}Alerts{% endblock %}
{% block box1content %}
{% with messages = get_flashed_messages() %}
{% if messages %}
<ul class="flashes">
    {% for message in messages %}
    <li>{{ message }}</li>
    {% endfor %}
</ul>
{% else %}
<p>There are no alerts to display.</p>
{% endif %}
{% endwith %}
{% endblock %}


{% block main %}

<h2>{% if uploaded_video %}Video: {{uploaded_video}}{% else %}Upload Video{% endif %}</h2>
{% if not uploaded_video %}
<div style="display:none;">
{% endif %}
<video id="videoPlayer" preload="metadata" tabindex="-1" disablePictureInPicture>
    <source src="{{ url_for('send_uploaded_file', filename=uploaded_video) }}" type="video/mp4">
</video>
<div class="videoControls hidden" id="videoControls">

    <div class="video-progress">
        <progress id="progress-bar" value="0" min="0" aria-hidden="true"></progress>
        <input class="seek" id="seek" value="0" min="0" type="range" step="0.1" aria-label="Video Timeline">
        <div class="seek-tooltip" id="seek-tooltip" aria-hidden="true">00:00</div>
    </div>

    <div class="time"> <!--aria-live="polite"-->
        <!-- TODO accessible label for video progress/duration? -->
        <span>
            <time id="time-elapsed">00:00.00</time>
            /
            <time id="duration">00:00.00</time>
        </span>
        <span class="mark">Mark 1: <time id="mark1">00:00.00</time></span>
        <span class="mark">Mark 2: <time id="mark2">00:00.00</time></span>
    </div>
    <div class="marks">
        <h3 class="screen-reader-text">Marks</h3>
        <form onsubmit="return updateMarkForm(1);" method="POST" name="m1-form">
            <fieldset>
                <legend>Mark 1</legend>
                <div>
                    <label for="m1-mm"><span class="screen-reader-text">Minutes</span><span aria-hidden="true">mm</span></label>
                    <input type="number" name="m1-mm" id="m1-mm" min="0" value="0"> <!-- TODO add max? if implementing hours -->
                </div>
                <div>
                    <label for="m1-ss"><span class="screen-reader-text">Seconds</span><span aria-hidden="true">ss</span></label>
                    <input type="number" name="m1-ss" id="m1-ss" min="0" max="59" value="0">
                </div>
                <div>
                    <label for="m1-ms"><span class="screen-reader-text">Milliseconds</span><span aria-hidden="true">ms</span></label>
                    <input type="number" name="m1-ms" id="m1-ms" min="0" max="59" value="0">
                </div>
            </fieldset>
            <input type="submit" value="Update Mark 1">
        </form>
        <form onsubmit="return updateMarkForm(2);" method="POST" name="m2-form">
            <fieldset>
                <legend>Mark 1</legend>
                <div>
                    <label for="m2-mm"><span class="screen-reader-text">Minutes</span><span aria-hidden="true">mm</span></label>
                    <input type="number" name="m2-mm" id="m2-mm" min="0" value="0"> <!-- TODO add max? if implementing hours -->
                </div>
                <div>
                    <label for="m2-ss"><span class="screen-reader-text">Seconds</span><span aria-hidden="true">ss</span></label>
                    <input type="number" name="m2-ss" id="m2-ss" min="0" max="59" value="0">
                </div>
                <div>
                    <label for="m2-ms"><span class="screen-reader-text">Milliseconds</span><span aria-hidden="true">ms</span></label>
                    <input type="number" name="m2-ms" id="m2-ms" min="0" max="59" value="0">
                </div>
            </fieldset>
            <input type="submit" value="Update Mark 2">
        </form>
    </div>

    <nav aria-labelledby="video-heading">
        <h3 class="screen-reader-text" id="video-heading">Playhead</h3>
        <ul class="inline">
            <li><button id="playButton" onclick="togglePlay()">Play</button></li>
            <li><button id="largeLeftStep">-10<span aria-hidden="true">s</span><span class="screen-reader-text">seconds</span></button></li>
            <li><button id="smallLeftStep">-1<span aria-hidden="true">s</span><span class="screen-reader-text">second</span></button></li>
            <li><button id="smallRightStep">+1<span aria-hidden="true">s</span><span class="screen-reader-text">second</span></button></li>
            <li><button id="largeRightStep">+10<span aria-hidden="true">s</span><span class="screen-reader-text">seconds</span></button></li>
            <!-- <li><button id="logTime" onclick="logCurrentTime()">Log Time to Console</button></li> -->
        </ul>
    </nav>
    <nav aria-labelledby="edit-heading">
        <h3 class="screen-reader-text" id="edit-heading">Edit</h3>
        <ul class="inline">
            <li><button id="addMark1">Add Mark 1</button></li>
            <li><button id="addMark2">Add Mark 2</button></li>
            <li><button id="playSelection" disabled>Play Selection</button></li>
            <!-- <li><button id="trim" disabled>Trim to Selection</button></li> -->
            <li>
                <form method="POST" action="{{ url_for('trim', filename=uploaded_video, start=mark1, stop=5) }}">
                    <button id="trim">Trim</button>
                </form>
            </li>
            <li><button id="delete" disabled>Delete Selection</button></li>
        </ul>
    </nav>
    <nav aria-labelledby="download-heading">
        <h3 class="screen-reader-text" id="download-heading">Download</h3>
        <form method="POST" action="{{ url_for('download_file', filename=uploaded_video) }}">
            <button id="download" class="large-button">Download {{uploaded_video}}</button>
        </form>
    </nav>
</div>
<script src="{{ url_for('static', filename='scripts/videoPlayer.js')  }}"></script>
<script src="{{ url_for('static', filename='scripts/AVEVideoKeybinds.js')  }}"></script>
<!-- update marks -->
<script src="{{ url_for('static', filename='scripts/marks.js')  }}"></script>
{% if not uploaded_video %}
</div>
<script src="{{ url_for('static', filename='scripts/videoUploadForm.js')  }}"></script>
<form method="POST" enctype="multipart/form-data" action="{{ url_for('upload') }}">
    <div>
        <label for="video" id="video-label">Select a MP4 video: </label>
        <input type="file" id="video" name="video" required accept=".mp4" onchange="updateUploadForm()">
    </div>
    <button type="submit" class="large-button" id="upload-button">Upload</button>
</form>
{% endif %}
{% endblock %}
